package com.mphasis.training.daoimpl;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Savepoint;
import java.util.Random;

import com.mphasis.training.dao.EmployeeDao;
import com.mphasis.training.model.Details;
import com.mphasis.training.util.DbUtil;

public class BankServicesImpl {
	Connection con = null;
	public BankServicesImpl() {
		con = DbUtil.getConnection();
	}
	/*public String openAccount() 
	{
		String 
		return null;
	}
*/	
	public boolean openSavingsAccount(Details details) throws SQLException {
		boolean flag = false,flag1=false;
		Savepoint savepoint=null;
		con.setAutoCommit(false);
		try {
			String sql = "INSERT into customer VALUES(?,?,?,?,?,?,?)";
			PreparedStatement ps = con.prepareStatement(sql);
			ps.setString(1, details.getCustomer_id());
			ps.setString(2, details.getCustomer_name());
			ps.setInt(3, details.getAge());
			ps.setString(4, details.getPan_number());
			ps.setString(5, details.getMail_id());
			ps.setString(6, details.getPassword());
			ps.setString(7, details.getPhone_no());
			ps.executeUpdate();
			
			con.commit();
			savepoint=con.setSavepoint();
			
			sql="insert into savings_account values(?,?,?)";
			ps = con.prepareStatement(sql);
			ps.setString(1, details.getSb_account_id());
			ps.setString(2, details.getCustomer_id());
			ps.setDouble(3, details.getSb_balance());
			ps.executeUpdate();

			con.commit();
		} catch(SQLException e) {
			e.printStackTrace();
		}
		return (flag&&flag1);
	}
	public String customerIdGenerator() throws SQLException
	{
		
		int value=0;
		boolean check ;
		int customer_no;
		String customer_id;
		do
		{
			value=0;
			Random rand=new Random();
			customer_no = rand.nextInt(89999)+10000;
			customer_id="MLA"+customer_no;
			String sql="select count(*) from customer where customer_id=?"; 
			PreparedStatement pst=con.prepareStatement(sql);
			pst.setString(1, customer_id);
			ResultSet rs=pst.executeQuery();
			while(rs.next())
			{
				 value=rs.getInt(1);
			}
			if(value==0)
			{
				check=true;
			}
			else
				check=false;
		}while(check=false);
		return customer_id;
	}
	boolean addEmployee(EmployeeDao e)
	{
		String sql="insert into employee values(?)";
		return false;
		
	}
}
